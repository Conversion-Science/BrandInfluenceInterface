<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Influencer Campaign Review Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .view { display: none; }
        .view.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .spinner { border-top-color: #3498db; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 sm:p-6 lg:p-8 antialiased">

    <div id="message-box" class="fixed top-5 right-5 p-4 rounded-lg shadow-xl text-white z-50 hidden transition-transform transform translate-x-full"></div>

    <!-- Active Audit Indicator -->
    <div id="active-audit" class="fixed top-4 right-4 bg-yellow-500 text-white px-4 py-2 rounded-lg shadow-lg hidden">
        <div class="flex items-center">
            <svg class="animate-spin h-5 w-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            <span>Audit in progress...</span>
        </div>
    </div>

    <!-- Hidden field for campaign ID -->
    <input type="hidden" id="campaign-id" value="{{ campaign_id }}">

    <div class="max-w-7xl mx-auto">
        <header class="flex justify-between items-center mb-6">
            <div class="flex items-center space-x-4">
                <h1 class="text-3xl font-bold text-gray-800">Influencer Posts Summary</h1>
                <button id="refresh-btn" title="Refresh Data" class="p-2 text-gray-500 hover:bg-gray-200 hover:text-gray-800 rounded-full transition duration-300">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                    </svg>
                </button>
            </div>
            <button id="back-to-summary-btn" class="py-2 px-4 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition duration-300 hidden">
                ← Back to Summary
            </button>
        </header>

        <div id="loading-indicator" class="text-center p-10 hidden">
            <div class="spinner animate-spin w-10 h-10 border-4 border-gray-300 rounded-full mx-auto"></div>
            <p class="mt-4 text-gray-600">Fetching data from Airtable...</p>
        </div>

        <!-- ===== Summary View ===== -->
        <div id="summary-view" class="view active">
            <button id="back-to-campaigns-btn"
        class="py-2 px-4 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition duration-300">
    ← Back to Campaigns
</button>
            {% if campaign_id %}
<div class="mb-6 bg-blue-50 p-4 rounded-lg border border-blue-200">
    <h2 class="text-xl font-semibold text-blue-800">Campaign:
        <span class="font-normal">{{ campaign_name }}</span>
    </h2>
</div>
{% endif %}


            <div id="summary-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
    <div class="bg-white p-6 rounded-xl shadow-md"><p class="text-sm text-gray-500">Total Active Influencers</p><p id="total-influencers" class="text-3xl font-bold text-gray-800">{{ summary_data.number_of_influencers }}</p></div>
    <div class="bg-white p-6 rounded-xl shadow-md"><p class="text-sm text-gray-500">Not Uploaded Yet</p><p id="videos-not-uploaded" class="text-3xl font-bold text-yellow-600">{{ summary_data.videos_not_loaded_yet }}</p></div>
    <div class="bg-white p-6 rounded-xl shadow-md"><p class="text-sm text-gray-500">Posts without Issues</p><p id="videos-approved" class="text-3xl font-bold text-green-600">{{ summary_data.videos_with_no_issues }}</p></div>
    <div class="bg-white p-6 rounded-xl shadow-md"><p class="text-sm text-gray-500">Posts with Issues</p><p id="videos-issues" class="text-3xl font-bold text-red-600">{{ summary_data.videos_with_issues }}</p></div>
    <div class="bg-white p-6 rounded-xl shadow-md"><p class="text-sm text-gray-500">Needs Manual Review</p><p id="videos-manual-review" class="text-3xl font-bold text-blue-600">{{ summary_data.videos_for_manual_review }}</p></div>
</div>
            <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-6">
                <button data-review-type="issues" class="review-btn bg-red-500 hover:bg-red-600 text-white font-bold py-4 px-6 rounded-lg shadow-lg transition duration-300">Review Posts with Issues</button>
                <button data-review-type="not_uploaded" class="review-btn bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-4 px-6 rounded-lg shadow-lg transition duration-300">Message Influencers (Not Uploaded)</button>
                <button data-review-type="manual_review" class="review-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-4 px-6 rounded-lg shadow-lg transition duration-300">Perform Manual Post Review</button>
            </div>
        </div>

        <!-- ===== Review View ===== -->
        <div id="issues-view" class="view bg-white p-8 rounded-xl shadow-lg">
            <h2 id="review-heading" class="text-3xl font-bold text-gray-800 mb-6 text-center"></h2>
            <div id="issues-content" class="hidden">
                <div class="flex justify-between items-center mb-6">
                    <h3 id="issues-counter" class="text-xl font-semibold text-gray-700"></h3>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
                    <!-- Left Panel -->
                    <div class="flex flex-col space-y-4">
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p class="text-sm font-medium text-gray-500">Influencer Name:</p>
                            <p id="issues-influencer-name" class="text-lg font-semibold text-gray-800"></p>
                        </div>

                        <!-- Video Link (for issues and manual review) -->
                        <div id="video-link-container" class="bg-gray-50 p-4 rounded-lg hidden">
                            <p class="text-sm font-medium text-gray-500">Video Link:</p>
                            <a id="issues-video-link" href="#" target="_blank" class="text-lg font-semibold text-blue-600 hover:underline">View Post</a>
                        </div>

                        <!-- Social Profiles (for not uploaded) -->
                        <div id="social-profiles-container" class="hidden">
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <p class="text-sm font-medium text-gray-500">TikTok Profile:</p>
                                <a id="tiktok-link" href="#" target="_blank" class="text-blue-600 hover:underline">View Profile</a>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <p class="text-sm font-medium text-gray-500">Instagram Profile:</p>
                                <a id="instagram-link" href="#" target="_blank" class="text-blue-600 hover:underline">View Profile</a>
                            </div>
                        </div>

                        <!-- Issues Logged (for issues) -->
                        <div id="issues-container" class="bg-red-50 p-4 rounded-lg border border-red-200 hidden">
                            <p class="text-sm font-medium text-red-700 mb-1">Issues Logged:</p>
                            <p id="issues-caption-issue" class="text-base text-red-800"></p>
                        </div>

                        <!-- Transcript (for manual review) -->
                        <div id="transcript-container" class="bg-gray-50 p-4 rounded-lg hidden">
                            <p class="text-sm font-medium text-gray-500 mb-2">Video Transcript:</p>
                            <p id="transcript-text" class="text-gray-800 whitespace-pre-line"></p>
                        </div>
                    </div>

                    <!-- Right Panel -->
                    <div class="flex flex-col space-y-4">
                        <div id="message-container">
                            <label for="issues-message" class="block text-gray-700 text-sm font-medium mb-2">Suggested Message:</label>
                            <textarea id="issues-message" class="w-full h-48 p-4 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                        </div>

                        <div id="comment-container" class="hidden">
                            <label for="manager-comment" class="block text-gray-700 text-sm font-medium mb-2">Your Comment:</label>
                            <textarea id="manager-comment" class="w-full h-48 p-4 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                        </div>

                        <button id="action-btn" class="w-full py-3 px-4 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700">
                            Send Message
                        </button>
                    </div>
                </div>
                <div class="flex justify-between mt-6">
                    <button id="issues-prev-btn" class="py-3 px-6 rounded-lg text-white font-semibold bg-gray-600 hover:bg-gray-700">
                        ← Previous Post
                    </button>
                    <button id="issues-next-btn" class="py-3 px-6 rounded-lg text-white font-semibold bg-blue-600 hover:bg-blue-700">
                        Next Post →
                    </button>
                </div>
            </div>
            <div id="issues-empty" class="text-center p-10 text-gray-500 hidden"></div>
        </div>
    </div>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
    // Add this to your script.js or in a <script> tag
    document.getElementById('back-to-campaigns-btn').addEventListener('click', () => {
        window.location.href = "{{ url_for('campaign_select') }}";
    });
</script>
</body>
</html>
